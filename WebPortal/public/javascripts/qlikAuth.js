
if (getURLParameter("qlikTicket") == null){
    getAuthAndRedirect()
}
var qlikTicket;
function getAuthAndRedirect() {
    $.ajax({
        url: (config.isSecure ? "https://" : "http://" ) + EngineHost + ":" + EnginePort + "/getTicket",
        dataType: "json"
    }).done(function (data) {
        // window.location = window.location.href + "?qlikTicket=" + data.Ticket;
        // var newWindow = window.open('', '_blank');
        // newWindow.document.write('Loading data...');
        // newWindow.location.href = window.location.protocol + '//' + window.location.hostname + '/tick/resources/img/core/dark_noise_16x16.png?qlikTicket=' + getURLParameter("qlikTicket");
        // setTimeout(function () { newWindow.close();}, 3000);
        qlikTicket = data.Ticket;
        $(qlikLogin).attr('src', (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix +'resources/img/core/dark_noise_16x16.png?qlikTicket=' + data.Ticket);
        $(qlikLogin).bind('load',loadScripts);
        // $(qlikLogin).hide();
        // setTimeout(loadScripts, 1000);

    });
}
function loadScripts(){
    $(qlikLogin).hide();
    // console.log((config.isSecure ? "https://" : "http://" ) + config.host + config.prefix +"resources/autogenerated/qlik-styles.css?qlikTicket=" + qlikTicket + "\">");
    // $("head").append("<link href=\"" + (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix +"resources/autogenerated/qlik-styles.css\" rel=\"stylesheet\">");
    // $("head").append("<script src=\"" + (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix + "resources/assets/external/requirejs/require.js\">");
    $("head").append("<link href=" + (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix +"resources/autogenerated/qlik-styles.css?qlikTicket=" + qlikTicket + "\" rel=\"stylesheet\">");
    $("head").append("<script src="+ (config.isSecure ? "https://" : "http://" ) + config.host + config.prefix + "resources/assets/external/requirejs/require.js?qlikTicket=" + qlikTicket + "\"></script>");
    $("head").append("<script src=\"/javascripts/bootstrap.min.js\"></script>");
    $("head").append("<script src=\"/javascripts/renderVis.js\"></script>");
    $("head").append("<script src=\"/javascripts/dropdownpopulation.js\"></script>");
    $("head").append("<script src=\"/javascripts/getCSVFile.js\"></script>");
    $("head").append("<script src=\"/javascripts/main.js\"></script>");
}

function getURLParameter(name) {
  return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
}